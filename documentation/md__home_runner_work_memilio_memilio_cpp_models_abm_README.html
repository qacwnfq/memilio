<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MEmilio: Agent-Based Model</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MEmilio
   &#160;<span id="projectnumber">0.7</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Agent-Based Model </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This module models and simulates the epidemic using an agent-based model (<em>ABM</em>) approach. Unlike the <a class="el" href="md__home_runner_work_memilio_memilio_cpp_models_ode_secir_README.html">SECIR</a> compartmental model that uses a system of ODEs, this model simulates the spread of COVID-19 in a population with discrete persons (the agents) moving throughout locations in the world and interacting with (infecting) each other.</p>
<h1><a class="anchor" id="autotoc_md34"></a>
Structure</h1>
<p>The model consists of the following major classes:</p>
<ol type="1">
<li>Person: represents an agent of the model. A person has an ID, i.e. a unique number, an age, a location and a list with their assigned locations, i.e. the locations they visit during the simulation. They can perform tests and wear masks. Every person has lists with past and current infections and vaccinations.</li>
<li>Infection: collection of all information about a persons' infection, i.e. infectiousness, infection course, virus variant. The infection course is drawn stochastically from the infection states that are similar to the compartments of the SECIR model.</li>
<li>Location: represents places in the world where people meet and interact, e.g. home, school, work, social event sites. A location can be split into cells to model parts of a location, like classrooms in a school. Some infection parameters are location-specific and one can activate NPIs like mandatory masks or tests to enter the location.</li>
<li>World: collection of all persons and locations. It also holds information about the testing strategy of the simulation and holds the rules for the migration phase.</li>
<li>Simulation: runs the simulation and stores results.</li>
</ol>
<h1><a class="anchor" id="autotoc_md35"></a>
Simulation</h1>
<p>The simulation runs in discrete time steps. Each step has two phases, an interaction phase and a migration phase.</p>
<h2><a class="anchor" id="autotoc_md36"></a>
Interaction Phase</h2>
<p>In this phase, each person interacts with the other persons at the same location. This interaction determines the transmission of the disease. A susceptible person can become infected by contact with an infected person. The probability of infection depends on a multitude of factors, such as the viral load and infectiousness of the infected and the immunity level of the susceptible person.</p>
<h2><a class="anchor" id="autotoc_md37"></a>
Migration Phase</h2>
<p>During the migration phase, each person may change their location. Migration follows complex <a href="../abm/migration_rules.cpp">rules</a>, considering the current location, time of day, and properties of the person (e.g. age). Some location changes are deterministic and regular (e.g. going to work), others are random (e.g. going to shopping or to a social event in the evening/on the weekend). When agents are infected, they are quarantined and cannot migrate. You can restrict some migration rules by allowing only a proportion of people to enter specific locations.</p>
<p>Another way of migration we use in the simulation of Braunschweig (simulations/abm_braunschweig.cpp) is using trips. A trip consists of the ID of the person that performs this trip, a time point when this trip is performed and where the person is heading to. At the beginning of the simulation, a list with all trips is initialized and followed during the simulation. There can be different trips on the weekend than during the week, but other than that, the agents do the same trips every day. As before, agents that are in quarantine or in the hospital cannot migrate.</p>
<h1><a class="anchor" id="autotoc_md38"></a>
Get Started</h1>
<p>This section gives an introduction to how to use the ABM and set up your own simulation. For a quick overview, can find a full example in the <a href="../../examples/abm_minimal.cpp">ABM minimal example</a> and a more detailed Doxygen documentation <a href="https://scicompmod.github.io/memilio/documentation/index.html">here</a>. For a guide on installation and running the simulations and examples, see this <a class="el" href="md__home_runner_work_memilio_memilio_cpp_README.html">README</a>.</p>
<p>Every person in the ABM belongs to an AgeGroup, which we can define as follows: <br  />
</p>
<div class="fragment"><div class="line"><span class="keywordtype">size_t</span> num_age_groups         = 4;  </div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> age_group_0_to_4   = <a class="code" href="structmio_1_1AgeGroup.html">mio::AgeGroup</a>(0);  </div>
<div class="line"><span class="keyword">const</span> <span class="keyword">auto</span> age_group_5_to_14  = <a class="code" href="structmio_1_1AgeGroup.html">mio::AgeGroup</a>(1);  </div>
<div class="line">...                           = ...  </div>
<div class="ttc" id="astructmio_1_1AgeGroup_html"><div class="ttname"><a href="structmio_1_1AgeGroup.html">mio::AgeGroup</a></div><div class="ttdoc">The AgeGroup struct is used as a dynamically sized tag for all age dependent categories.</div><div class="ttdef"><b>Definition:</b> age_group.h:32</div></div>
</div><!-- fragment --><p>Note that every age group has to have values strictly smaller than the number of age groups <code>num_age_groups</code>. <br  />
 With this number we create an empty world: <br  />
</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> world = <a class="code" href="classmio_1_1abm_1_1World.html">mio::abm::World</a>(num_age_groups);</div>
<div class="ttc" id="aclassmio_1_1abm_1_1World_html"><div class="ttname"><a href="classmio_1_1abm_1_1World.html">mio::abm::World</a></div><div class="ttdoc">The World of the Simulation.</div><div class="ttdef"><b>Definition:</b> world.h:50</div></div>
</div><!-- fragment --><p>We can set several general parameters, which you can find <a href="../abm/parameters.h">here</a>. Here is an example where we set the duration of the incubation period to 4 days:</p>
<div class="fragment"><div class="line">world.parameters.get&lt;<a class="code" href="structmio_1_1abm_1_1IncubationPeriod.html">mio::abm::IncubationPeriod</a>&gt;() = 4.</div>
<div class="ttc" id="astructmio_1_1abm_1_1IncubationPeriod_html"><div class="ttname"><a href="structmio_1_1abm_1_1IncubationPeriod.html">mio::abm::IncubationPeriod</a></div><div class="ttdoc">Time that a Person is infected but not yet infectious.</div><div class="ttdef"><b>Definition:</b> parameters.h:45</div></div>
</div><!-- fragment --><p>To add a location to the world, we have to specify the kind of location.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> home = world.add_location(<a class="code" href="namespacemio_1_1abm.html#a83bc98ab43329c10fe9a6e683f2e1d0fa8cf04a9734132302f96da8e113e80ce5">mio::abm::LocationType::Home</a>);</div>
<div class="ttc" id="anamespacemio_1_1abm_html_a83bc98ab43329c10fe9a6e683f2e1d0fa8cf04a9734132302f96da8e113e80ce5"><div class="ttname"><a href="namespacemio_1_1abm.html#a83bc98ab43329c10fe9a6e683f2e1d0fa8cf04a9734132302f96da8e113e80ce5">mio::abm::LocationType::Home</a></div><div class="ttdeci">@ Home</div></div>
</div><!-- fragment --><p>People are added with an age. Then we have to assign them, so the world knows they can travel to this location.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> person = world.add_person(home, age_group_0_to_4);</div>
<div class="line">person.set_assigned_location(home);</div>
</div><!-- fragment --><p>For adding more people to the world, we create households. A Household holds a vector of HouseholdMembers, which in turn hold a weighted distribution, such that we can randomly draw the age of each Person belonging to the Household. To manage multiple Households of the same type, we can use a HouseholdGroup. In our example, we categorize individuals into two groups: children and parents.</p>
<ul>
<li>Children: They can either belong to AgeGroup(0) or AgeGroup(1). The probability of a child belonging to either group is 0.5.</li>
<li>Parents: They can either belong to AgeGroup(2) or AgeGroup(3). The probability of a parent belonging to either group is also 0.5.</li>
</ul>
<p>We then form households in two ways:</p>
<ol type="1">
<li>Households with one parent and one child.</li>
<li>Households with two parents and one child.</li>
</ol>
<div class="fragment"><div class="line"><span class="keyword">auto</span> child = <a class="code" href="classmio_1_1abm_1_1HouseholdMember.html">mio::abm::HouseholdMember</a>(num_age_groups);</div>
<div class="line">child.set_age_weight(age_group_0_to_4, 1);</div>
<div class="line">child.set_age_weight(age_group_0_to_4, 1);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> parent = <a class="code" href="classmio_1_1abm_1_1HouseholdMember.html">mio::abm::HouseholdMember</a>(num_age_groups);</div>
<div class="line">parent.set_age_weight(age_groups_15_to_34, 1);</div>
<div class="line">parent.set_age_weight(age_groups_35_to_59, 1);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Two-person household with one parent and one child.</span></div>
<div class="line"><span class="keyword">auto</span> twoPersonHousehold_group = <a class="code" href="classmio_1_1abm_1_1HouseholdGroup.html">mio::abm::HouseholdGroup</a>();</div>
<div class="line"><span class="keyword">auto</span> twoPersonHousehold_full  = <a class="code" href="classmio_1_1abm_1_1Household.html">mio::abm::Household</a>();</div>
<div class="line">twoPersonHousehold_full.add_members(child, 1);</div>
<div class="line">twoPersonHousehold_full.add_members(parent, 1);</div>
<div class="line">twoPersonHousehold_group.add_households(twoPersonHousehold_full, n_households);</div>
<div class="line"><a class="code" href="namespacemio_1_1abm.html#a73adb25b82b9429795e0fac81c2e5997">add_household_group_to_world</a>(world, twoPersonHousehold_group);</div>
<div class="ttc" id="aclassmio_1_1abm_1_1HouseholdGroup_html"><div class="ttname"><a href="classmio_1_1abm_1_1HouseholdGroup.html">mio::abm::HouseholdGroup</a></div><div class="ttdoc">A HouseholdGroup represented by different Households.</div><div class="ttdef"><b>Definition:</b> household.h:156</div></div>
<div class="ttc" id="aclassmio_1_1abm_1_1HouseholdMember_html"><div class="ttname"><a href="classmio_1_1abm_1_1HouseholdMember.html">mio::abm::HouseholdMember</a></div><div class="ttdoc">A HouseholdMember represented by a weighted age distribution.</div><div class="ttdef"><b>Definition:</b> household.h:52</div></div>
<div class="ttc" id="aclassmio_1_1abm_1_1Household_html"><div class="ttname"><a href="classmio_1_1abm_1_1Household.html">mio::abm::Household</a></div><div class="ttdoc">A Household represented by a vector with HouseholdMembers.</div><div class="ttdef"><b>Definition:</b> household.h:92</div></div>
<div class="ttc" id="anamespacemio_1_1abm_html_a73adb25b82b9429795e0fac81c2e5997"><div class="ttname"><a href="namespacemio_1_1abm.html#a73adb25b82b9429795e0fac81c2e5997">mio::abm::add_household_group_to_world</a></div><div class="ttdeci">void add_household_group_to_world(World &amp;world, const HouseholdGroup &amp;household_group)</div><div class="ttdoc">Adds Households from a HouseholdGroup to the World.</div><div class="ttdef"><b>Definition:</b> household.cpp:81</div></div>
</div><!-- fragment --><p>During the simulation, people can get tested, and we have to specify the scheme for that:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> testing_min_time = <a class="code" href="namespacemio_1_1abm.html#ac50d53d4d672f332b55133479478fe6a">mio::abm::days</a>(1);</div>
<div class="line"><span class="keyword">auto</span> probability      = 0.5;</div>
<div class="line"><span class="keyword">auto</span> start_date       = <a class="code" href="classmio_1_1abm_1_1TimePoint.html">mio::abm::TimePoint</a>(0);</div>
<div class="line"><span class="keyword">auto</span> end_date         = <a class="code" href="classmio_1_1abm_1_1TimePoint.html">mio::abm::TimePoint</a>(0) + <a class="code" href="namespacemio_1_1abm.html#ac50d53d4d672f332b55133479478fe6a">mio::abm::days</a>(30);</div>
<div class="line"><span class="keyword">auto</span> test_type        = <a class="code" href="structmio_1_1abm_1_1AntigenTest.html">mio::abm::AntigenTest</a>();</div>
<div class="line"><span class="keyword">auto</span> test_at_work     = std::vector&lt;mio::abm::LocationType&gt;{<a class="code" href="namespacemio_1_1abm.html#a83bc98ab43329c10fe9a6e683f2e1d0fa0f9263536b9fc61ada745644735bfd8f">mio::abm::LocationType::Work</a>};</div>
<div class="line"><span class="keyword">auto</span> testing_criteria_work =</div>
<div class="line">    std::vector&lt;mio::abm::TestingCriteria&gt;{<a class="code" href="classmio_1_1abm_1_1TestingCriteria.html">mio::abm::TestingCriteria</a>({}, test_at_work, {})};</div>
<div class="line"><span class="keyword">auto</span> testing_scheme_work =</div>
<div class="line">    <a class="code" href="classmio_1_1abm_1_1TestingScheme.html">mio::abm::TestingScheme</a>(testing_criteria_work, testing_min_time, start_date, end_date, test_type, probability);</div>
<div class="line">world.get_testing_strategy().add_testing_scheme(testing_scheme_work);</div>
<div class="ttc" id="aclassmio_1_1abm_1_1TestingCriteria_html"><div class="ttname"><a href="classmio_1_1abm_1_1TestingCriteria.html">mio::abm::TestingCriteria</a></div><div class="ttdoc">TestingCriteria for TestingScheme.</div><div class="ttdef"><b>Definition:</b> testing_strategy.h:41</div></div>
<div class="ttc" id="aclassmio_1_1abm_1_1TestingScheme_html"><div class="ttname"><a href="classmio_1_1abm_1_1TestingScheme.html">mio::abm::TestingScheme</a></div><div class="ttdoc">TestingScheme to regular test Persons.</div><div class="ttdef"><b>Definition:</b> testing_strategy.h:105</div></div>
<div class="ttc" id="aclassmio_1_1abm_1_1TimePoint_html"><div class="ttname"><a href="classmio_1_1abm_1_1TimePoint.html">mio::abm::TimePoint</a></div><div class="ttdoc">Represents a point in time.</div><div class="ttdef"><b>Definition:</b> time.h:155</div></div>
<div class="ttc" id="anamespacemio_1_1abm_html_a83bc98ab43329c10fe9a6e683f2e1d0fa0f9263536b9fc61ada745644735bfd8f"><div class="ttname"><a href="namespacemio_1_1abm.html#a83bc98ab43329c10fe9a6e683f2e1d0fa0f9263536b9fc61ada745644735bfd8f">mio::abm::LocationType::Work</a></div><div class="ttdeci">@ Work</div></div>
<div class="ttc" id="anamespacemio_1_1abm_html_ac50d53d4d672f332b55133479478fe6a"><div class="ttname"><a href="namespacemio_1_1abm.html#ac50d53d4d672f332b55133479478fe6a">mio::abm::days</a></div><div class="ttdeci">TimeSpan days(int days)</div><div class="ttdoc">Create a TimeSpan with a specified number of days.</div><div class="ttdef"><b>Definition:</b> time.h:322</div></div>
<div class="ttc" id="astructmio_1_1abm_1_1AntigenTest_html"><div class="ttname"><a href="structmio_1_1abm_1_1AntigenTest.html">mio::abm::AntigenTest</a></div><div class="ttdoc">Reliability of an AntigenTest.</div><div class="ttdef"><b>Definition:</b> parameters.h:334</div></div>
</div><!-- fragment --><p>For some infections to happen during the simulation, we have to initialize people with infections.</p>
<div class="fragment"><div class="line">person.add_new_infection(<a class="code" href="classmio_1_1abm_1_1Infection.html">mio::abm::Infection</a>(rng, <a class="code" href="namespacemio_1_1abm.html#a92b83c9298d24c2568847dfd9843011fa89a4b46fc862c6127bfbde1a860d5ea0">mio::abm::VirusVariant::Wildtype</a>, person.get_age(), world.parameters, start_date, infection_state));</div>
<div class="ttc" id="aclassmio_1_1abm_1_1Infection_html"><div class="ttname"><a href="classmio_1_1abm_1_1Infection.html">mio::abm::Infection</a></div><div class="ttdef"><b>Definition:</b> infection.h:50</div></div>
<div class="ttc" id="anamespacemio_1_1abm_html_a92b83c9298d24c2568847dfd9843011fa89a4b46fc862c6127bfbde1a860d5ea0"><div class="ttname"><a href="namespacemio_1_1abm.html#a92b83c9298d24c2568847dfd9843011fa89a4b46fc862c6127bfbde1a860d5ea0">mio::abm::VirusVariant::Wildtype</a></div><div class="ttdeci">@ Wildtype</div></div>
</div><!-- fragment --><p>We can add restrictions for people after a specific date. For example, only 10% of the people go to social events after day 10.</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> t_lockdown = <a class="code" href="classmio_1_1abm_1_1TimePoint.html">mio::abm::TimePoint</a>(0) + <a class="code" href="namespacemio_1_1abm.html#ac50d53d4d672f332b55133479478fe6a">mio::abm::days</a>(10);</div>
<div class="line"><a class="code" href="namespacemio_1_1abm.html#a47117440f3164885597b07b402db921b">mio::abm::close_social_events</a>(t_lockdown, 0.9, world.parameters);</div>
<div class="ttc" id="anamespacemio_1_1abm_html_a47117440f3164885597b07b402db921b"><div class="ttname"><a href="namespacemio_1_1abm.html#a47117440f3164885597b07b402db921b">mio::abm::close_social_events</a></div><div class="ttdeci">void close_social_events(TimePoint t_begin, double p, Parameters &amp;params)</div><div class="ttdoc">During lockdown Persons join social events less often.</div><div class="ttdef"><b>Definition:</b> lockdown_rules.cpp:42</div></div>
</div><!-- fragment --><p>Then we run the simulation.</p>
<div class="fragment"><div class="line">sim.advance(<a class="code" href="classmio_1_1abm_1_1TimePoint.html">mio::abm::TimePoint</a>(0) + <a class="code" href="namespacemio_1_1abm.html#ac50d53d4d672f332b55133479478fe6a">mio::abm::days</a>(30));</div>
</div><!-- fragment --><p>Alternitavely if we want to track things in the simulation, we need to set up a <a href="../../memilio/io/README.md#the-history-object">history</a>, for example, to track all the Infection states of each simulation step.</p>
<div class="fragment"><div class="line"><a class="code" href="classmio_1_1History.html">mio::History&lt;mio::abm::TimeSeriesWriter, mio::abm::LogInfectionState&gt;</a> history;</div>
<div class="ttc" id="aclassmio_1_1History_html"><div class="ttname"><a href="classmio_1_1History.html">mio::History</a></div><div class="ttdoc">History class that handles writers and loggers.</div><div class="ttdef"><b>Definition:</b> history.h:71</div></div>
</div><!-- fragment --><p>Then we can run the simulation with the history object and one can access the data it through get_log.</p>
<div class="fragment"><div class="line">sim.advance(tmax, history);</div>
<div class="line"><span class="keyword">auto</span> <a class="code" href="namespacemio.html#a7a8e658f565465ae076eab415d976e1b">log</a> = history.<a class="code" href="classmio_1_1History.html#a20f07b05d192e015c4f5cfff0c48c7f5">get_log</a>();</div>
<div class="ttc" id="aclassmio_1_1History_html_a20f07b05d192e015c4f5cfff0c48c7f5"><div class="ttname"><a href="classmio_1_1History.html#a20f07b05d192e015c4f5cfff0c48c7f5">mio::History::get_log</a></div><div class="ttdeci">const WriteWrapper::Data &amp; get_log() const</div><div class="ttdoc">Get the data object.</div><div class="ttdef"><b>Definition:</b> history.h:107</div></div>
<div class="ttc" id="anamespacemio_html_a7a8e658f565465ae076eab415d976e1b"><div class="ttname"><a href="namespacemio.html#a7a8e658f565465ae076eab415d976e1b">mio::log</a></div><div class="ttdeci">void log(LogLevel level, spdlog::string_view_t fmt, const Args &amp;... args)</div><div class="ttdef"><b>Definition:</b> logging.h:122</div></div>
</div><!-- fragment --><p>Finally we can print the data to a text file.</p>
<div class="fragment"><div class="line">std::ofstream outfile(<span class="stringliteral">&quot;abm_minimal.txt&quot;</span>);</div>
<div class="line">std::get&lt;0&gt;(<a class="code" href="namespacemio.html#a7a8e658f565465ae076eab415d976e1b">log</a>).print_table({<span class="stringliteral">&quot;S&quot;</span>, <span class="stringliteral">&quot;E&quot;</span>, <span class="stringliteral">&quot;I_NS&quot;</span>, <span class="stringliteral">&quot;I_Sy&quot;</span>, <span class="stringliteral">&quot;I_Sev&quot;</span>, <span class="stringliteral">&quot;I_Crit&quot;</span>, <span class="stringliteral">&quot;R&quot;</span>, <span class="stringliteral">&quot;D&quot;</span>}, 7, 4, outfile);</div>
<div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Results written to abm_minimal.txt&quot;</span> &lt;&lt; std::endl;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md39"></a>
Current Limitations</h1>
<p>Currently, a few things are not yet implemented, such as:</p>
<ul>
<li>Different trips for each day.</li>
<li>Test and Trace functionality </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
